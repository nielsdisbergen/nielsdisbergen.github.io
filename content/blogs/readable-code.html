<!DOCTYPE html>

<html lang="en">


<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
  <title> Niels R. Disbergen - Blog </title>

  <!-- CSS  Loc, Dist -->
  <link href="../../css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="../../css/style.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="../../css/prettify/tomorrow-night-eighties.css" type="text/css" rel="stylesheet" />

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">

</head>

<body onload="prettyPrint()">

  <nav class="mintgreen" role="navigation">

    <ul id="code-dev-dsk" class="dropdown-content">
      <li><a href="../projects.html">Projects</a></li>
      <li><a href="../snippets.html">Snippets</a></li>
      <li><a href="../code/misc-code.html">Misc</a></li>
      <li><a href="http://github.com/nielsdisbergen">GitHub<i class="fa fa-github" style="font-size:28px;color:teal"></i></a></li>
    </ul>

    <ul id="code-dev-mob" class="dropdown-content">
      <li><a href="../projects.html">Projects</a></li>
      <li><a href="../snippets.html">Snippets</a></li>
      <li><a href="../code/misc-code.html">Misc</a></li>
      <li><a href="http://github.com/nielsdisbergen">GitHub</a></li>
    </ul>

    <div class="nav-wrapper container">

      <a class="white-text" href="../../index.html"><i class="material-icons left" style="font-size:25px">account_balance</i></a>
      <a class="white-text" href="../../index.html">Niels R. Disbergen</a>

      <ul class="right hide-on-med-and-down">
        <li><a class="white-text" href="../about-me.html">About Me</a></li>
        <li><a class="white-text" href="../blog_main.html">Blog</a></li>
        <li><a class="white-text" href="../publications_main.html">Publications</a></li>
        <li><a class="white-text dropdown-button" href="#" data-activates="code-dev-dsk">Codes<i class="material-icons right">arrow_drop_down</i></a></li>
        <li><a class="white-text" href="../links.html">Links</a></li>
        <li><a class="white-text" href="../contact.html">Contact</a></li>
      </ul>

      <ul id="nav-mobile" class="side-nav teal">
        <li><a class="white-text" href="../about-me.html">About Me</a></li>
        <li><a class="white-text" href="../blog_main.html">Blog</a></li>
        <li><a class="white-text" href="../publications_main.html">Publications</a></li>
        <li><a class="white-text dropdown-button" href="#" data-activates="code-dev-mob">Codes<i class="material-icons right">arrow_drop_down</i></a></li>
        <li><a class="white-text" href="../links.html">Links</a></li>
        <li><a class="white-text" href="../contact.html">Contact</a></li>
      </ul>

      <a href="#" data-activates="nav-mobile" class="button-collapse white-text"><i class="material-icons" style="font-size:24px;">menu</i></a>

    </div>
  </nav>

  <div class="container">
    <div class="section">

      <div class="left">
        <h3 class="brown-text left">Writing Readable and Well Formatted Code - Why Bother?</h3>
      </div>

      <div class="row">

        <div class="col s12 left">
          <h6 class="brown-text left" style="font-size:9pt"><em>Posted 21 January 2019</em></h6>
          <br><br>

          <p>This is the first post in what will, hopefully, become a series tapping into what I believe are important attributes of well-written and maintainable (scientific) code. This is an introduction to the controversial among some, and often polarizing, topic of code formatting and commenting, <i>id est</i> code readability. Even though the term code readability, which I strongly believe is a great attribute for both others and your future self, entails several broader coding concepts, we will start off by looking into some initial formatting and commenting here, returning to other topics later on. And yes, almost all of these discussions also apply to all of you scripting-only/loving folks out there.</p><br>

          <h4 class="brown-text">Introduction</h4>
          <p>Before diving in head-deep and burning my fingers, I wanted to share a few responses I have encountered, on multiple occasions, when discussing this topic with other scientist:
          <ul style="list-style-type:none">

            <li>"<i>These things are not important, what matters is that it works, if others want to understand my code they should just go through it line by line and figure out themselves what it does</i>"</li><br>

            <li>"<i>It takes too much time to do all this [formatting and commenting], I better use it to perform other tasks</i>"</li><br>

            <li>"<i>I am not a computer engineer, so why bother, this is not my job</i>"</li>
          </ul>
          </p>

          <p>Across these posts I will mostly make use of examples in MATLAB which are specifically tailored to neuroscientists, even though their logic applies to most other languages and problems out there as well. Many of the items are simplifications of larger problems, where, for example, the use of a for-loop with an incrementing counter is necessary, hence examples will be presented where it is possible to solve the small-scale simplification discussed here with another (more simplistic) counter-structure; the same argumentation applies to a possible over-use of for-loop structures. Examples are mostly based on encounters in my work as a code-loving neuroscientist, therefore I will mostly employ examples drawn from common issues encountered in science-coding. Such approach will hopefully allowing peers to apply these suggestions in situations where very often the large-scale problem requires quite specific code structures.</p>

          <p>One of the most important concepts  in developing code is that when there is no organization in your head, it will be very hard to get any organization in your code. This is one of the most common problems I encounter in peers (and myself), along with the skill of splitting large, seemingly unmanageable, problems into small solvable chunks of code. This often results in large amounts of unclear and messy code which become untraceable even by those who developed it. On that note, I am convinced that old-fashioned pen and pencil exercises (or their digital equivalent) along with drawings are a necessity to work out code problems, resulting in more thought-through end results; as a bonus it serves as a great debugging tool as well! This goes hand-in-hand with another good concept to continuously keep in the back of your mind: 'think twice, code once'.</p>


          <p>Another of my favorite approaches to clean code, though slightly more radical, is to delete all your code once you finished a limited-scale block and re-write it from scratch; I have never encountered a situation in which this did not lead to a cleaner (and often more optimized) end result. For many coding tasks the main job at hand is solving the small-scale section of a larger problem, and once it has been solved (through coding) you have the answer in mind, which will therefore allow you to write a cleaner/better implementation for the same problem, mostly leading to the same end-result though with cleaner and more maintainable code.</p>

          <p>Style guides can form a solid back-bone on the road to cleaner code, for a nice general and concise MATLAB style guide have a look at <a href="https://www.mathworks.com/matlabcentral/fileexchange/46056-matlab-style-guidelines-2-0" target="_blank" class="brown-text">Richard Johnson's</a> one, while for Python I personally like <a href="https://github.com/google/styleguide/blob/gh-pages/pyguide.md" target="_blank" class="brown-text"> Google's version</a>, even though <a href="https://www.python.org/dev/peps/pep-0008" target="_blank" class="brown-text"> PEP8</a> is pretty nice as well. Regardless of which guidelines you follow, consistency in your code is most important, and most difficult.</p>
          <br>

          <h4 class="brown-text">A Small Starter</h4>

            <p>Today will provide a taste of some of the things I will be discussing during the next posts. Below I introduce a general function-call within a script looping over multiple subjects. A first implementation is presented, and accordingly I discuss how this could be improved.</p>

            <p>
            Below is a simple MATLAB script employing a time-series correlation analysis function <code>CorrelateTimeSeries()</code> which is called within a for-loop, where it computes correlations for a non-continuously named/numbered set of subjects stored in <code>includedSubjects</code>:
            <pre class="prettyprint lang-matlab" style="center-align">includedSubjects = [1 3 7];
nSubjects = length(includedSubjects);

correlateTimeSeriesIndividuals = nan(128, 128, nSubjects)
for indexSubject = 1:nSubjects
    dataFile{indexSubject, 1} = sprintf('S%i_DataFile.mat', indexSubject);
    correlatedTimeSeriesIndividuals(:, :, indexSubject) = CorrelateTimeSeries(dataFile{indexSubject, 1});
    % ...
    save(sprintf('%s_CorrTimeSeries.mat', dataFile{cntSubj, 1}(1:end-4)), correlatedTimeSeriesIndividuals);
end

if sum(isnan(correlateTimeSeriesIndividuals(:)) ~= 0)
  error('Variable "correlatedTimeSeriesIndividuals" contains NaN')
end</pre></p>
              <p>Now let us first have an 'old-fashioned' look at how this loop runs: when <code>indexSubject = 1</code>, dataFile{1,1} will evaluate to '<code>S1_DataFile.mat</code>', so far so good. Heading into the next iteration <code>indexSubject = 2</code>, dataFile{2,1} will evaluate to '<code>S2_DataFile.mat</code>', here some issue arises because subject <code>S2</code> is not included in the list of subjects to analyze: <code>includedSubjects = [1 3 7]</code>. Before continuing reading, try to come up with a solution how to solve this problem and see if there are any other improvements you would make to this code.</p>

              <p>The issue mentioned above is the more serious problem with this code, but overall there are few other items to be tackled. In general it is good practice to list your 'issues' and approach them one-by-one, hence based on above example we will look into the following, non-exhaustive, list of improvements:
              <ol type="1">
              <li>Variable <code>dataFile</code> evaluates to incorrect file-names in/from second loop</li>
              <li>Loop-counter naming is not ideal</li>
              <li>Error throwing implementation can be improved</li>
              <li>Some comments would be good</li>
              </ol>

              Let us look more detailedly into #2: the counter-variable name <code>indSubject</code> indicates that we are dealing with an 'index' variable, which in the case discussed here is not per definition incorrect, though it does lead to some confusion. Index in this case could refer to the implementation of the variable as an index to store data in our matrix <code>correlatedTimeSeriesIndividuals</code>, but this is not the only task it performs. Probably a better interpretation of the variable name would be that this loop-counter provides for the index of a subject, which in its current version is not the case; note that this would be correct if our subjects were a continuous incrementation (e.g. <code>[1 2 3]</code>). Try not to make the 'mistake' of thinking, "I only use continuous subjects so this is fine". Out of experience: it is not. Not only is this a bad implementation from the scalability and code-reuse perspective, it greatly limits your code generalization and may cause potentially unnoticed incorrect data storage/retrieval down the line. Even if your subjects are continuous, it would be best to choose another name in the light of code flexibility and clarity, also because we may not always include all subjects in the future. A better name for this variable would be <code>counterSubject</code>, referencing that it counts over subjects and hence it is the index by which you can extract the ID/name of that subject being analyzed from the subject-vector <code>includedSubjects</code>. When you want to retrieve the subject index, we can easily extract it via <code>includedSubjects(counterSubject)</code>. Personally, since these variable naming structures are used very often for indexing, I tend to abbreviate the index and counter names (along with the subject indicator) to reduce the character count, even though syntactically this is not ideal, as <code>ind</code> and <code>cnt</code>, respectively, leading to <code>indSubj</code> and <code>cntSubj</code>.
              </p>

              <p>
              Returning to the code example above and applying the suggested changes:
              <pre class="prettyprint lang-matlab" style="center-align">includedSubjects = [1 3 7]; % subject IDs
nSubjects = length(includedSubjects);

correlateTimeSeriesIndividuals = nan(128, 128, nSubjects); % collect time-series correlations
for cntSubj = 1:nSubjects
    dataFile{cntSubj, 1} = sprintf('S%i_DataFile.mat', includedSubjects(cntSubj)); % subject specific data-file
    correlatedTimeSeriesIndividuals(:, :, cntSubj) = CorrelateTimeSeries(dataFile{cntSubj, 1});
    % ...
    save(sprintf('%s_CorrTimeSeries.mat', dataFile{cntSubj, 1}(1:end-4)), 'correlatedTimeSeriesIndividuals');
end

% NaN will remain in correlatedTimeSeriesIndividuals if entries are not all filled,
% or corrcoef() inside CorrelateTimeSeries() threw NaNs. In either case, computations
% should be halted, as NaNs are not handled.
if sum(isnan(correlateTimeSeriesIndividuals(:)) ~= 0)
    throw(MException('SubjectAnalysis:CorrelatedTimeSeriesIndividualsContainsNaN', ...
      'Variable "correlatedTimeSeriesIndividuals" contains %i NaN', ...
      sum(isnan(correlateTimeSeriesIndividuals(:)) ~= 0)));
end</pre></p>

              <p>Note that here I row-index the subjects, which does not necessarily have to be the case. Even though (in MATLAB) I think it is a good choice to vectorize in the row-direction, the most important thing is that you always remain constant in your index choices. For example, when indexing matrices across subjects my largest/last dimension is always the subject one, which is merely an insertion of dimensions from the initial 1-dimensional row-based subject-indexing. When indexing, always take a moment to consider what is the most logical index-order for your variables and try to remain constant in your choices, this can save you a lot of headaches down the line.</p>

              <br>

              <p>That was all for today's appetizer, hopefully I managed to spark some interest into building more readable and well formatted code in your next project. Do not forget: 'think twice, code once'.</p>

              <p><code>- Happy Coding -</code></p>

              <p>p.s. in case you would like to learn more on how to implement the type of code syntax highlighting I use here on your own webpage, have a look at my <a href=".\codemarkup.html" class=brown-text>Using Source Code Syntax Highlighting</a> post.</p>

<!-- <a class="twitter-timeline" data-width="450" data-height="450" data-link-color="#19CF86" href="https://twitter.com/nrdscidev?ref_src=twsrc%5Etfw">Tweets by @nrdscidev</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> -->

        </div> <!-- main -->
      </div>

    </div>
  </div>


  <footer class="page-footer">
    <div class="container">

        <div class="col l12 s12 center">

          <a href="http://github.com/nielsdisbergen" target="_blank">
            <i class="fa fa-github" style="font-size:48px;color:black"></i>
          </a>

          <a href="http://www.linkedin.com/in/nielsdisbergen" target="_blank">
            <i class="fa fa-linkedin-square" style="font-size:48px;color:black"></i>
          </a>

          <a href="http://twitter.com/nrdscidev" target="_blank">
            <i class="fa fa-twitter" style="font-size:48px;color:black"></i>
          </a>

        </div>

      </div>
    </div>
    <div class="footer-copyright center">
      <div class="container">
      Niels Disbergen &#169 <span id="copyright"><script>document.getElementById('copyright').appendChild(document.createTextNode(new Date().getFullYear()))</script></span> - All Rights Reserved - Hosted on <a class="white-text" href="https://pages.github.com/" target="blank"> Github Pages</a> and built with <a class="white-text" href="http://materializecss.com" target="blank"> Materialize </a>
      </div>
    </div>
  </footer>


  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="../../js/materialize.js"></script>
  <script src="../../js/init.js"></script>
  <script type="text/javascript" src="../../js/prettify/prettify.js"></script>

  </body>
</html>
